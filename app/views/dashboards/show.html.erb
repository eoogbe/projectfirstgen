<% provide(:title, "Dashboard") %>

<% if current_user.admin? %>
  <section>
    <h3>At a glance</h3>
    <div class="row">
      <p class="col-sm-6">
        <%= link_to "#{pluralize(Article.pending.count, "blog")} pending approval", admin_articles_path %>
      </p>
      <p class="col-sm-6">
        <%= link_to "#{pluralize(Comment.pending.count, "question")} pending approval", admin_comments_path %>
      </p>
    </div>
    <div class="row">
      <p class="col-sm-6">
        <%= link_to "#{pluralize(Comment.unanswered.count, "question")} unanswered", admin_comments_path %>
      </p>
      <p class="col-sm-6">
        <%= link_to pluralize(User.count, "user"), admin_users_path %>
      </p>
    </div>
  </section>
<% end %>
<section>
  <h3>Monthly Activity</h3>
  <% if policy(Article.new).create? %>
    <section>
      <h4>Blogs</h4>
      <% if current_user.current_articles.exists? %>
        <ul class="list-unstyled">
          <% current_user.current_articles.each do |article| %>
            <li>
              <%= link_to article.title, article %>
              <%= local_date article.created_at %>
            </li>
          <% end %>
        </ul>
        <% if current_user.article_raffle_eligible? %>
          <p>
            You are eligible for our monthly raffle.
            <%= link_to "Enter raffle", raffle_entries_path, method: :post %>
          </p>
        <% end %>
      <% else %>
        <p>You have not written any blogs this month</p>
      <% end %>
      <p><%= link_to "New Blog", new_article_path %></p>
    </section>
  <% end %>
  <section>
    <h4>Questions</h4>
    <% if current_user.current_comments.exists? %>
      <ul class="list-unstyled">
        <% current_user.current_comments.each do |comment| %>
          <li>
            <p class="text-muted">
              On <%= link_to comment.article_title, article_path(comment.article, anchor: "comment-#{comment.id}") %>
              at <%= local_time comment.created_at %>
            </p>
            <div class="lines-3 truncate">
              <% comment.paragraphs.each do |text| %>
                <p><%= text %></p>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
      <% if current_user.comment_raffle_eligible? %>
        <p>
          You are eligible for our monthly raffle.
          <%= button_to "Enter raffle", raffle_entries_path, class: "btn-link" %>
        </p>
      <% end %>
    <% else %>
      <p>You have not asked any questions this month</p>
    <% end %>
  </section>
</section>
